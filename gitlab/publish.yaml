#######################
# Publish stage
#######################
.publish:
    image: docker:19.03.12
    services:
    - name: docker:19.03.12-dind
      command: ["--experimental"]
    only:
    - tags
    extends: .default
    stage: publish
    script:
    - docker login -u "${CI_REGISTRY_USER}" -p "${CI_REGISTRY_PASSWORD}" $CI_REGISTRY
    - docker pull "${CI_REGISTRY_IMAGE}:${CI_COMMIT_SHA}"
    - docker tag "${CI_REGISTRY_IMAGE}:${CI_COMMIT_SHA}" "${CI_REGISTRY_IMAGE}:${CI_COMMIT_TAG}"
    - docker push "${CI_REGISTRY_IMAGE}:${CI_COMMIT_TAG}"

# PHP 7.0
###########################
publish:7.0-cli:
    extends:
    - .publish
    - .7.0-cli

publish:7.0-devel:
    extends:
    - .publish
    - .7.0-devel

publish:7.0-fpm:
    extends:
    - .publish
    - .7.0-fpm

# PHP 7.1
###########################
publish:7.1-cli:
    extends:
    - .publish
    - .7.1-cli

publish:7.1-devel:
    extends:
    - .publish
    - .7.1-devel

publish:7.1-fpm:
    extends:
    - .publish
    - .7.1-fpm

# PHP 7.2
###########################
publish:7.2-cli:
    extends:
    - .publish
    - .7.2-cli

publish:7.2-devel:
    extends:
    - .publish
    - .7.2-devel

publish:7.2-fpm:
    extends:
    - .publish
    - .7.2-fpm

# PHP 7.3
###########################
publish:7.3-cli:
    extends:
    - .publish
    - .7.3-cli

publish:7.3-devel:
    extends:
    - .publish
    - .7.3-devel

publish:7.3-fpm:
    extends:
    - .publish
    - .7.3-fpm

# PHP 7.4
###########################
publish:7.4-cli:
    extends:
    - .publish
    - .7.4-cli

publish:7.4-devel:
    extends:
    - .publish
    - .7.4-devel

publish:7.4-fpm:
    extends:
    - .publish
    - .7.4-fpm

